/*! contextual-comments 2014-03-10 13:06:11 */
(function(){"use strict";var a,b,c,d,e,f,g=function(a,b){return function(){return a.apply(b,arguments)}};try{if("undefined"==typeof $||null===$)throw"You must include jQuery";if("undefined"==typeof _||null===_)throw"You must include undescore"}catch(h){f=h,console.warn("Error : "+f)}window.gc||(window.gc={}),window.gc.comments||(window.gc.comments={}),_.extend(_,{subpart:function(a,b){var c,d;return d=!1,c="",$(a).toArray().forEach(function(a){var e;return"#comment"!==a.nodeName&&d?(e=a.outerHTML?a.outerHTML:a.textContent,c+=e.replace(/[\n\r\t]/g,"").trim()):"#comment"===a.nodeName&&(a.data.trim()===b+" template start"&&(d=!0),a.data.trim()===b+" template end")?d=!1:void 0}),_.unescape(c)}}),b=function(){function a(a){return this._bindDatas=g(this._bindDatas,this),this._initVars(a)._render()._binds(),this}return a.prototype._availableOptions=["_cc","uid","parentId","index","selection","author","email","comment"],a.prototype._initVars=function(a){return _.extend(this,_.pick(a,this._availableOptions)),this},a.prototype._bindDatas=function(){return this._el=$(this._el),$.data(this._el,"uid",this.uid),$.data(this._el,"index",this.index),$.data(this._el,"parentId",this.parentId),$.data(this._el,"selection",this.selection),console.log(this._el,$.data(this._el)),this},a.prototype._binds=function(){return this._cc.dispatcher.on("bindDatasToCommentsItem",this._bindDatas),this},a.prototype._getAvatar=function(){return'<img src="http://www.gravatar.com/avatar/'+gc.comments.MD5(this.email)+'?s=40" alt=""/>'},a.prototype._render=function(){return this._el=_.template(this._cc._commentView,{avatar:this._getAvatar(),author:this.author,comment:this.comment,parentId:this.parentId}),this},a}(),("undefined"!=typeof module&&null!==module?module.exports:void 0)?exports.gc.comments.Comment=b:window.gc.comments.Comment=b,d=function(){function a(a){return this._formSubmit=g(this._formSubmit,this),this._hide=g(this._hide,this),this._initVars(a)._build()._binds(),this}return a.prototype._initVars=function(a){return this._cc=(null!=a?a.cc:void 0)||null,this._parent=(null!=a?a.parent:void 0)||null,this},a.prototype.show=function(){return this._el.slideDown("fast"),this},a.prototype._hide=function(){return this._el.slideUp("fast"),this._cc.dispatcher.trigger("hideAllForms"),this},a.prototype._empty=function(){var a;return a=this._el.find("form"),a.get(0).reset(),this},a.prototype._formSubmit=function(a){var b;return a.preventDefault(),b=$(a.target),this._cc.dispatcher.trigger("addComment",{comment:{parentId:b.find("#cc-parentId").val(),index:b.find("#cc-index").val(),selection:b.find("#cc-selection").val(),author:b.find("#cc-author").val(),email:b.find("#cc-email").val(),message:b.find("#cc-message").val()}}),this._empty()._hide(),this},a.prototype._binds=function(){return this._el.find(".cancel").on("click",this._hide),this._el.find("form").on("submit",this._formSubmit),this},a.prototype._build=function(){return this._el=$(_.template(this._cc._formView,{authorLabel:this._cc.ll("form.authorLabel"),emailLabel:this._cc.ll("form.emailLabel"),messageLabel:this._cc.ll("form.messageLabel"),submitLabel:this._cc.ll("form.leaveANote"),cancelLabel:this._cc.ll("form.cancelLabel")})).appendTo(this._parent._el.find("ul")),this},a}(),("undefined"!=typeof module&&null!==module?module.exports:void 0)?exports.gc.comments.Form=d:window.gc.comments.Form=d,a=function(){function a(a){return this._click=g(this._click,this),this._out=g(this._out,this),this._hover=g(this._hover,this),this._hide=g(this._hide,this),this._show=g(this._show,this),this._initVars(a)._refreshLabel()._render()._binds(),this}return a.prototype._initVars=function(a){return this._cc=(null!=a?a.cc:void 0)||null,this._target=$(null!=a?a.target:void 0)||null,this._target&&(this._index=this._target.index()),this},a.prototype._refreshLabel=function(){var a;return a=this._cc._getCommentsByIndex(this._index),this._commentLength=a.length,this._label=this._commentLength?this._commentLength:"+",this._render(),this},a.prototype._getPosition=function(){var a,b;return b=$(this._target),a=b.offset(),{top:a.top,left:a.left+b.outerWidth()+this._cc.gapBetweenButtonAndList}},a.prototype._show=function(a){var b;return b=$(a.target),this._isShown=!0,this._el.fadeIn("fast"),b},a.prototype._hide=function(a){var b,c,d,e;return c=$(a.target),d=this,b=null!=(e=a.data)?e.force:void 0,this._isShown=this._commentLength,!this._isShown&&b?this._el.fadeOut(0):setTimeout(function(){return d._isShown?void 0:d._el.fadeOut("fast")},1e3),c},a.prototype._hover=function(a){var b;return b=$(a.target),this._isShown=!0,b.addClass("comment-active"),b},a.prototype._out=function(a){var b;return b=$(a.target),b.removeClass("comment-active"),b},a.prototype._click=function(a){var b;return b=$(a.target),this._cc.dispatcher.trigger("hideAllLists",this._target),this._cc.dispatcher.trigger("showList",this._target),b},a.prototype._binds=function(){return this._el.on("mouseenter",this._show).on("mouseenter",this._hover).on("mouseleave",this._out).on("click",this._click),this._target.on("mouseenter",this._show).on("mouseout",this._hide),this},a.prototype._render=function(){var a;return this._el=$(_.template(this._cc._buttonView,{label:this._label})),a=this._getPosition(),this._el.css({top:a.top,left:a.left}).appendTo(this._cc._container),this._hide({data:{force:!0}}),this},a}(),("undefined"!=typeof module&&null!==module?module.exports:void 0)?exports.gc.comments.Button=a:window.gc.comments.Button=a,e=function(){function a(a){return this._addComment=g(this._addComment,this),this._showReply=g(this._showReply,this),this._showForm=g(this._showForm,this),this._hide=g(this._hide,this),this._show=g(this._show,this),this._initVars(a)._retrieveComments()._build()._binds(),this}return a.prototype._comments=[],a.prototype._initVars=function(a){return this._cc=(null!=a?a.cc:void 0)||null,this._target=(null!=a?a.target:void 0)||null,this._target&&(this._target=$(this._target),this._index=this._target.index()),this},a.prototype._retrieveComments=function(){return this._cc&&(this._commentsTemp=this._cc._getCommentsByIndexAndParentId(this._index,0),this._comments=this._parseComments(this._commentsTemp,[])),this},a.prototype._parseComments=function(a,b){return a&&a.length&&a.forEach(function(a){return function(c){return b.push(new gc.comments.Comment(_.extend(c,{_cc:a._cc}))),c.children?b=a._parseComments(c.children,b):void 0}}(this)),b},a.prototype._getPosition=function(){var a,b;return b=$(this._target),a=b.offset(),{top:a.top,left:a.left+b.outerWidth()-this._el.outerWidth()}},a.prototype._show=function(a,b){var c;return this._cc.dispatcher.trigger("hideAllForms"),b===this._target.get(0)&&(this._ghostEl?(this._el.appendTo(this._cc._container).fadeIn("fast"),c=this._getPosition(),this._el.css({top:c.top,left:c.left}),this._ghostEl=null):this._hide()),a.target},a.prototype._hide=function(a,b){return b&&b===this._target.get(0)||this._el.fadeOut("fast",function(a){return function(){return a._ghostEl=a._el.detach()}}(this)),this},a.prototype._getInfosFromReply=function(a){var b,c;return b={index:this._index,parentId:0,selection:""},(null!=a?a.prev():void 0)&&(c=a.closest(".item"),console.log(c,$.data(c))),b},a.prototype._showForm=function(a){var b,c,d;return c=$(a.target),b=this._getInfosFromReply(c),this._cc.dispatcher.trigger("hideAllForms"),d=$(a.target).slideUp("fast"),this._form.show()._el.insertAfter(d),this},a.prototype._showReply=function(){return this._el.find(".reply").slideDown("fast"),this},a.prototype._addComment=function(a,b){return(null!=b?b.comment:void 0)&&(null!=b?b.comment.index:void 0)===this._index&&console.log("c est moi",this._index),this},a.prototype._binds=function(){return this._cc.dispatcher.on("showList",this._show),this._cc.dispatcher.on("hideAllLists",this._hide),this._el.find(".reply").on("click",this._showForm),this._cc.dispatcher.on("hideAllForms",this._showReply),this._cc.dispatcher.on("addComment",this._addComment),this._hide(),this},a.prototype._build=function(){return this._el=$(_.template(this._cc._listView,{comments:this._comments,replyLabel:this._cc.ll("form.replyLabel"),form:this._form})),this._cc.dispatcher.trigger("bindDatasToCommentsItem"),this._form=new gc.comments.Form({cc:this._cc,parent:this}),this},a}(),("undefined"!=typeof module&&null!==module?module.exports:void 0)?exports.gc.comments.List=e:window.gc.comments.List=e,c=function(){function a(a){return this.addComment=g(this.addComment,this),this._initVars(a)._initTemplates(),this}return a.prototype.target="body",a.prototype.selector="p, img, li",a.prototype.containerId="comments-container",a.prototype.comments=[],a.prototype.gapBetweenButtonAndList=20,a.prototype.dispatcher=$({}),a.prototype.templateFile="./templates/template.html",a.prototype._currentLanguage="en",a.prototype._l10n={en:{"form.replyLabel":"Reply","form.leaveANote":"Leave a note","form.cancelLabel":"Cancel","form.authorLabel":"Author","form.emailLabel":"Email","form.messageLabel":"Message"}},a.prototype._buttons=[],a.prototype._lists=[],a.prototype._availableOptions=["target","selector","containerId","comments","gapBetweenButtonAndList","templateFile"],a.prototype.ll=function(a){return this._l10n[this._currentLanguage][a]},a.prototype._initVars=function(a){return _.extend(this,_.pick(a,this._availableOptions)),"string"==typeof this.target&&(this.target=$(this.target)),this},a.prototype._initTemplates=function(){var a;return a=this,$.ajax(this.templateFile).success(function(b){return a._containerView=_.subpart(b,"container"),a._buttonView=_.subpart(b,"button"),a._listView=_.subpart(b,"list"),a._commentView=_.subpart(b,"comment"),a._formView=_.subpart(b,"form"),a._render()._binds()}),this},a.prototype._getCommentsByIndexAndParentId=function(a,b){var c,d;return c=[],d=this,this.comments.forEach(function(e){var f;return e.index===a&&e.parentId===b?(f=_.extend({},e),f.children=d._getCommentsByIndexAndParentId(a,e.uid),c.push(f)):void 0}),c},a.prototype._getCommentsByIndex=function(a){var b,c;return b=[],c=this,this.comments.forEach(function(c){return c.index===a?b.push(c):void 0}),b},a.prototype.addComment=function(a,b){return(null!=b?b.comment:void 0)&&(this.comments.push(b.comment),console.log(this.comments)),this},a.prototype._build=function(){var a;return a=this,this.target.find(this.selector).each(function(){var b,c;return b=new gc.comments.Button({cc:a,target:this}),a._buttons.push(b),c=new gc.comments.List({cc:a,target:this}),a._lists.push(c)}),this},a.prototype._binds=function(){return this.dispatcher.on("addComment",this.addComment),this},a.prototype._render=function(){return this._container=$(_.template(this._containerView,{container:this.containerId})),this._container.appendTo("body"),this._build(),this},a}(),("undefined"!=typeof module&&null!==module?module.exports:void 0)?exports.gc.Contextualcomments=c:window.gc.Contextualcomments=c,gc.comments.MD5=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O;for(p=function(a,b){return a<<b|a>>>32-b},c=function(a,b){var c,d,e,f,g;return d=void 0,f=void 0,e=void 0,g=void 0,c=void 0,e=2147483648&a,g=2147483648&b,d=1073741824&a,f=1073741824&b,c=(1073741823&a)+(1073741823&b),d&f?2147483648^c^e^g:d|f?1073741824&c?3221225472^c^e^g:1073741824^c^e^g:c^e^g},h=function(a,b,c){return a&b|~a&c},j=function(a,b,c){return a&c|b&~c},l=function(a,b,c){return a^b^c},n=function(a,b,c){return b^(a|~c)},i=function(a,b,d,e,f,g,i){return a=c(a,c(c(h(b,d,e),f),i)),c(p(a,g),b)},k=function(a,b,d,e,f,g,h){return a=c(a,c(c(j(b,d,e),f),h)),c(p(a,g),b)},m=function(a,b,d,e,f,g,h){return a=c(a,c(c(l(b,d,e),f),h)),c(p(a,g),b)},o=function(a,b,d,e,f,g,h){return a=c(a,c(c(n(b,d,e),f),h)),c(p(a,g),b)},f=function(a){var b,c,d,e,f,g,h,i;for(i=void 0,d=a.length,f=d+8,g=(f-f%64)/64,e=16*(g+1),h=Array(e-1),c=0,b=0;d>b;)i=(b-b%4)/4,c=b%4*8,h[i]=h[i]|a.charCodeAt(b)<<c,b++;return i=(b-b%4)/4,c=b%4*8,h[i]=h[i]|128<<c,h[e-2]=d<<3,h[e-1]=d>>>29,h},H=function(a){var b,c,d,e;for(b="",c="",d=void 0,e=void 0,e=0;3>=e;)d=a>>>8*e&255,c="0"+d.toString(16),b+=c.substr(c.length-2,2),e++;return b},G=function(a){var b,c,d;for(a=a.replace(/\r\n/g,"\n"),d="",c=0;c<a.length;)b=a.charCodeAt(c),128>b?d+=String.fromCharCode(b):b>127&&2048>b?(d+=String.fromCharCode(b>>6|192),d+=String.fromCharCode(63&b|128)):(d+=String.fromCharCode(b>>12|224),d+=String.fromCharCode(b>>6&63|128),d+=String.fromCharCode(63&b|128)),c++;return d},O=Array(),M=void 0,b=void 0,d=void 0,e=void 0,g=void 0,I=void 0,J=void 0,K=void 0,L=void 0,q=7,r=12,s=17,t=22,u=5,v=9,w=14,x=20,y=4,z=11,A=16,B=23,C=6,D=10,E=15,F=21,a=G(a),O=f(a),I=1732584193,J=4023233417,K=2562383102,L=271733878,M=0;M<O.length;)b=I,d=J,e=K,g=L,I=i(I,J,K,L,O[M+0],q,3614090360),L=i(L,I,J,K,O[M+1],r,3905402710),K=i(K,L,I,J,O[M+2],s,606105819),J=i(J,K,L,I,O[M+3],t,3250441966),I=i(I,J,K,L,O[M+4],q,4118548399),L=i(L,I,J,K,O[M+5],r,1200080426),K=i(K,L,I,J,O[M+6],s,2821735955),J=i(J,K,L,I,O[M+7],t,4249261313),I=i(I,J,K,L,O[M+8],q,1770035416),L=i(L,I,J,K,O[M+9],r,2336552879),K=i(K,L,I,J,O[M+10],s,4294925233),J=i(J,K,L,I,O[M+11],t,2304563134),I=i(I,J,K,L,O[M+12],q,1804603682),L=i(L,I,J,K,O[M+13],r,4254626195),K=i(K,L,I,J,O[M+14],s,2792965006),J=i(J,K,L,I,O[M+15],t,1236535329),I=k(I,J,K,L,O[M+1],u,4129170786),L=k(L,I,J,K,O[M+6],v,3225465664),K=k(K,L,I,J,O[M+11],w,643717713),J=k(J,K,L,I,O[M+0],x,3921069994),I=k(I,J,K,L,O[M+5],u,3593408605),L=k(L,I,J,K,O[M+10],v,38016083),K=k(K,L,I,J,O[M+15],w,3634488961),J=k(J,K,L,I,O[M+4],x,3889429448),I=k(I,J,K,L,O[M+9],u,568446438),L=k(L,I,J,K,O[M+14],v,3275163606),K=k(K,L,I,J,O[M+3],w,4107603335),J=k(J,K,L,I,O[M+8],x,1163531501),I=k(I,J,K,L,O[M+13],u,2850285829),L=k(L,I,J,K,O[M+2],v,4243563512),K=k(K,L,I,J,O[M+7],w,1735328473),J=k(J,K,L,I,O[M+12],x,2368359562),I=m(I,J,K,L,O[M+5],y,4294588738),L=m(L,I,J,K,O[M+8],z,2272392833),K=m(K,L,I,J,O[M+11],A,1839030562),J=m(J,K,L,I,O[M+14],B,4259657740),I=m(I,J,K,L,O[M+1],y,2763975236),L=m(L,I,J,K,O[M+4],z,1272893353),K=m(K,L,I,J,O[M+7],A,4139469664),J=m(J,K,L,I,O[M+10],B,3200236656),I=m(I,J,K,L,O[M+13],y,681279174),L=m(L,I,J,K,O[M+0],z,3936430074),K=m(K,L,I,J,O[M+3],A,3572445317),J=m(J,K,L,I,O[M+6],B,76029189),I=m(I,J,K,L,O[M+9],y,3654602809),L=m(L,I,J,K,O[M+12],z,3873151461),K=m(K,L,I,J,O[M+15],A,530742520),J=m(J,K,L,I,O[M+2],B,3299628645),I=o(I,J,K,L,O[M+0],C,4096336452),L=o(L,I,J,K,O[M+7],D,1126891415),K=o(K,L,I,J,O[M+14],E,2878612391),J=o(J,K,L,I,O[M+5],F,4237533241),I=o(I,J,K,L,O[M+12],C,1700485571),L=o(L,I,J,K,O[M+3],D,2399980690),K=o(K,L,I,J,O[M+10],E,4293915773),J=o(J,K,L,I,O[M+1],F,2240044497),I=o(I,J,K,L,O[M+8],C,1873313359),L=o(L,I,J,K,O[M+15],D,4264355552),K=o(K,L,I,J,O[M+6],E,2734768916),J=o(J,K,L,I,O[M+13],F,1309151649),I=o(I,J,K,L,O[M+4],C,4149444226),L=o(L,I,J,K,O[M+11],D,3174756917),K=o(K,L,I,J,O[M+2],E,718787259),J=o(J,K,L,I,O[M+9],F,3951481745),I=c(I,b),J=c(J,d),K=c(K,e),L=c(L,g),M+=16;return N=H(I)+H(J)+H(K)+H(L),N.toLowerCase()}}).call(this);