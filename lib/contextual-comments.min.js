/*! contextual-comments 2014-02-21 21:58:19 */
(function(){"use strict";var a,b,c;try{if("undefined"==typeof $||null===$)throw"You must include jQuery";if("undefined"==typeof _||null===_)throw"You must include undescore"}catch(d){c=d,console.warn("Error : "+c)}window.gc||(window.gc={}),_.extend(_,{subpart:function(a,b){var c,d;return d=!1,c="",$(a).toArray().forEach(function(a){return d&&a.outerHTML&&(c+=a.outerHTML),"#comment"===a.nodeName&&(a.data.trim()===b+" template start"&&(d=!0),a.data.trim()===b+" template end")?d=!1:void 0}),_.unescape(c)}}),a=function(){function a(a){return this._initVars(a)._retrieveComments()._render()._binds(),this}return a.prototype._comments=[],a.prototype._initVars=function(a){return this._parent=(null!=a?a.parent:void 0)||null,this._target=(null!=a?a.target:void 0)||null,this._target=$(this._target),this._index=this._target.index(),this},a.prototype._retrieveComments=function(){return this._parent&&(this._comments=this._parent._getCommentsByIndexAndParentId(this._index,0)),this},a.prototype._getLabel=function(){return this._comments.length?this._comments.length:"+"},a.prototype._getPosition=function(){var a,b;return b=$(this._target),a=b.offset(),{top:a.top,left:a.left+b.outerWidth()+this._parent.gapBetweenButtonAndList}},a.prototype._showButton=function(a){var b;return b=a.data.that,b._isButtonShown=!0,b._button.fadeIn("fast"),$(this)},a.prototype._hideButton=function(a){var b,c;return c=a.data.that,b=a.data.force,c._isButtonShown=c._comments.length,!c._isButtonShown&&b?c._button.fadeOut(0):setTimeout(function(){return c._isButtonShown?void 0:c._button.fadeOut("fast")},1e3),$(this)},a.prototype._hoverButton=function(a){var b,c;return c=a.data.that,b=$(a.target),c._isButtonShown=!0,b.addClass("comment-active"),b},a.prototype._outButton=function(a){var b;return b=$(a.target),b.removeClass("comment-active"),b},a.prototype._showList=function(){return this},a.prototype._hideList=function(){return this},a.prototype._binds=function(){return this._button.on("mouseenter",{that:this},this._showButton).on("mouseenter",{that:this},this._hoverButton).on("mouseleave",this._outButton),this._target.on("mouseenter",{that:this},this._showButton).on("mouseout",{that:this},this._hideButton),this},a.prototype._renderButton=function(){var a;return this._button=$(_.template(this._parent._commentsListButtonTemplate,{label:this._getLabel()})),a=this._getPosition(),this._button.css({top:a.top,left:a.left}).appendTo(this._parent._container),this._hideButton({data:{force:!0,that:this}}),this},a.prototype._render=function(){return this._renderButton(),this},a}(),("undefined"!=typeof module&&null!==module?module.exports:void 0)?exports.gc.Commentslist=gc.Commentslist:window.gc.Commentslist=a,b=function(){function a(a){return this._initVars(a)._initTemplates(),this}return a.prototype.target="body",a.prototype.selector="p, img, li",a.prototype.containerId="comments-container",a.prototype.comments=[],a.prototype.gapBetweenButtonAndList=20,a.prototype.templateFile="./templates/template.html",a.prototype._commentsLists=[],a.prototype._availableOptions=["target","selector","containerId","comments","gapBetweenButtonAndList","templateFile"],a.prototype._initVars=function(a){return _.extend(this,_.pick(a,this._availableOptions)),"string"==typeof this.target&&(this.target=$(this.target)),this},a.prototype._initTemplates=function(){var a;return a=this,$.ajax(this.templateFile).success(function(b){return a._containerTemplate=_.subpart(b,"container"),a._commentsListButtonTemplate=_.subpart(b,"list button"),a._commentsListTemplate=_.subpart(b,"list"),a._commentTemplate=_.subpart(b,"comment"),a._render()}),this},a.prototype._getCommentsByIndexAndParentId=function(a,b,c){var d;return c||(c=[]),d=this,this.comments.forEach(function(e){return e.index===a&&e.parentId===b?(c.push(e),d._getCommentsByIndexAndParentId(a,e.uid,c)):void 0}),c},a.prototype._buildLists=function(){var a;return a=this,this.target.find(this.selector).each(function(){var b;return b=new gc.Commentslist({parent:a,target:this}),a._commentsLists.push(b)}),this},a.prototype._render=function(){return this._container=$(_.template(this._containerTemplate,{container:this.containerId})),this._container.appendTo("body"),this._buildLists(),this},a}(),("undefined"!=typeof module&&null!==module?module.exports:void 0)?exports.gc.Contextualcomments=b:window.gc.Contextualcomments=b}).call(this);